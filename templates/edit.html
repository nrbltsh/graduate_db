{% extends 'base.html' %}
{% block title %}Редактировать выпускника{% endblock %}
{% block content %}
<h1>Редактировать выпускника</h1>
<form method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label class="form-label">Имя</label>
        <input type="text" class="form-control" name="name" value="{{ graduate.name }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Группа</label>
        <select class="form-control group-select" name="group">
            <option value=""></option>
            {% for group in groups %}
            <option value="{{ group }}" {% if group == graduate.group %}selected{% endif %}>{{ group }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Год выпуска</label>
        <input type="text" class="form-control" name="graduation_year" value="{{ graduate.graduation_year }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Факультет</label>
        <select class="form-control faculty-select" name="faculty">
            <option value=""></option>
            {% for faculty in faculties %}
            <option value="{{ faculty }}" {% if faculty == graduate.faculty %}selected{% endif %}>{{ faculty }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Биография</label>
        <textarea class="form-control" name="bio" rows="5">{{ graduate.bio or '' }}</textarea>
    </div>
    <div class="mb-3">
        <label class="form-label">Фото</label>
        <input type="file" class="form-control" name="photo" accept="image/*">
        {% if graduate.photo %}
        <p>Текущее фото: <img src="{{ url_for('static', filename='uploads/' + graduate.photo) }}" alt="Photo" style="max-width: 100px;"></p>
        {% endif %}
    </div>
    <div class="mb-3">
        <label class="form-label">Теги (выберите или введите новые)</label>
        <select class="form-control tags-select" name="tags" multiple>
            {% for tag in tags %}
            <option value="{{ tag.name }}" {% if tag.name in graduate.tags|map(attribute='name') %}selected{% endif %}>{{ tag.name }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Сохранить</button>
    <a href="{{ url_for('main.graduate', id=graduate.id) }}" class="btn btn-secondary">Отмена</a>
</form>

<!-- Подключение Choices.js -->
<link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Инициализация для тегов
        const tagsSelect = document.querySelector('.tags-select');
        new Choices(tagsSelect, {
            removeItemButton: true,
            allowHTML: false,
            placeholderValue: 'Введите теги',
            noResultsText: 'Тег не найден, введите новый',
            addItems: true,
            duplicateItemsAllowed: false,
        });

        // Инициализация для группы
        const groupSelect = document.querySelector('.group-select');
        new Choices(groupSelect, {
            allowHTML: false,
            placeholderValue: 'Введите группу',
            noResultsText: 'Группа не найдена, введите новую',
            addItems: true,
            duplicateItemsAllowed: false,
        });

        // Инициализация для факультета
        const facultySelect = document.querySelector('.faculty-select');
        new Choices(facultySelect, {
            allowHTML: false,
            placeholderValue: 'Введите факультет',
            noResultsText: 'Факультет не найден, введите новый',
            addItems: true,
            duplicateItemsAllowed: false,
        });
    });
</script>
{% endblock %}